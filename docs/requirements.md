# サイクルコンピュータ 要件定義書

## 1. 概要

Sony Spresense を使用したサイクルコンピュータの開発プロジェクト。GPS 情報から取得した「速度」と、現在時刻を表示する「時計」の機能を持ち、ボタン操作でこれらを切り替えて表示するデバイスを製作する。

## 2. システム構成

### 2.1 ハードウェア

- **マイコンボード**: Sony Spresense (メインボード + 必要に応じて拡張ボード)
- **GPS/GNSS**: Spresense 内蔵 GNSS 機能を使用
- **ディスプレイ**: LCD モジュール (SPI/I2C 接続などを想定)
- **入力インターフェース**: タクトスイッチ (プッシュボタン) x 1
- **電源**: USB 給電

### 2.2 ソフトウェア開発環境

- **プラットフォーム**: Arduino IDE
- **言語**: C++

## 3. 機能要件

### 3.1 速度計測・表示機能 (Speed Mode)

- **データソース**: GNSS 衛星からの測位データ (RMC/VTG センテンス等)
- **処理**:
  - GNSS から対地速度(knots)を取得し、時速(km/h)に換算する。
  - 値が更新されるたびにディスプレイ上の数値を更新する。
  - 停止時（速度が極めて小さい場合）は `0.0 km/h` と表示する。
- **表示**:
  - 現在速度を大きく表示する。
  - 単位（km/h）を併記する。

### 3.2 時刻表示機能 (Time Mode)

- **データソース**: GNSS 衛星からの時刻データ (UTC)
- **処理**:
  - 取得した UTC 時刻を日本標準時 (JST: UTC+9) に変換して保持する。
  - GNSS 未測位時は、RTC（もしあれば）または直前の時刻からのカウントアップで補完する考慮が必要だが、初期フェーズでは GNSS 同期時のみ正確な表示とする。
- **表示**:
  - `HH:MM` または `HH:MM:SS` 形式で現在時刻を表示する。

### 3.3 モード切替機能

- **入力**: 物理ボタンの押下（立ち上がり/立ち下がり検出）
- **動作**: ボタンを押すたびに以下のモードを循環する。
  1. **Speed Mode** (速度表示)
  2. **Time Mode** (時刻表示)

## 4. 非機能要件

- **リアルタイム性**: 走行中の速度変化に追従できるよう、ディスプレイの更新はスムーズに行う（GNSS の更新レートに依存、通常 1Hz）。
- **視認性**: 屋外での使用を想定し、直射日光下でも視認可能な UI レイアウト（大きなフォント、高コントラスト）を心がける。
- **拡張性**: 将来的に「走行距離」「平均速度」「最高速度」などの項目を追加しやすいクラス設計（State Pattern 等）を採用する。

## 5. クラス設計・構成案 (現状のコードベースに基づく)

- **`LCDDriver`**: ディスプレイ描画の抽象化レイヤー。文字列や数値の描画を担当。
- **`Button`**: チャタリング処理を含めたボタン入力の管理。
- **`ModeManager`**: 現在の表示モード（速度/時計）を管理し、ボタンイベントに応じて状態遷移を行う。
- **`GPSWrapper` (新規提案)**: Spresense の GNSS ライブラリをラップし、速度(km/h)や時刻(JST)を簡単に取得できるインターフェースを提供する。
